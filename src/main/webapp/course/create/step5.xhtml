<!-- Todo: Seite darf nur von Dozenten aufgerufen werden -->
<ui:composition template="/WEB-INF/base.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h5="http://xmlns.jcp.org/jsf/passthrough" xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui">
    <!-- Define Params -->
    <ui:param name="pageTitle" value="#{msg['courses.create']}" />
    <!-- Breadcrumbs -->
    <ui:define name="breadcrumbs">
        <li><h:link value="#{msg['courses.overview']}" outcome="/course/overview" /></li>
        <li class="active">#{msg['courses.create']}</li>
    </ui:define>
    <!-- Page Content -->
    <ui:define name="content">
        <div class="headline">
            <h1>#{msg['courses.create']}</h1>
        </div>

        <ul class="nav nav-wizard">
            <li><h:link outcome="/course/create/step1">
                <i class="fa fa-check-square-o"></i> #{msg['common.course.commonData']}</h:link></li>
            <li><h:link outcome="/course/create/step2">
                <i class="fa fa-check-square-o"></i> #{msg['common.course.exams']}</h:link></li>
            <li><h:link outcome="/course/create/step3">
                <i class="fa fa-check-square-o"></i> #{msg['common.course.participationTypes']}</h:link></li>
            <li><h:link outcome="/course/create/step4">
                <i class="fa fa-check-square-o"></i> #{msg['common.course.gradingFormula']}</h:link></li>
            <li class="active"><a><i class="fa fa-square-o"></i> #{msg['common.course.participants']}</a></li>
        </ul>

        <ui:include src="/WEB-INF/alerts.xhtml" />

        <h3>#{msg['common.course.participants']}</h3>

        <h:form layout="block" id="uploadform" enctype="multipart/form-data">
            <div class="row">
                <div class="col-xs-6">
                    <p>#{msg['import.hint']}</p>
                    <br />

                    <table class="table">
                        <thead>
                        <tr>
                            <th>#{msg['import.filename']}</th>
                            <th class="table-common-filesize">#{msg['import.filesize']}</th>
                            <th class="table-common-options-one"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <ui:repeat value="#{studentImportController.files}" var="file">
                        <tr class="vert-align-middle">
                            <td>#{file.fileName}</td>
                            <td>#{studentImportController.getHumanReadableFileSize(file.getSize())}</td>
                            <td>
                                <h:commandLink class="btn btn-danger">
                                    <f:ajax listener="#{studentImportController.removeFile(file)}"
                                            execute="@this"
                                            render="@form"/>
                                    <i class="fa fa-remove"></i>
                                </h:commandLink>
                            </td>
                        </tr>
                        </ui:repeat>
                        </tbody>
                    </table>
                    <p:fileUpload fileUploadListener="#{studentImportController.handleFileUpload}"
                                  mode="advanced" allowTypes="/(\.|\/)(csv)$/" auto="true"
                                  update="@form" uploadLabel="#{msg['import.upload']}"
                                  invalidFileMessage="#{msg['courses.create.invalidFileCSV']}"
                                  sizeLimit="#{EXcons.MAX_UPLOADFILE_SIZE}"/>
                    <h:commandButton class="btn btn-primary" action="#{studentImportController.executeImport()}"
                                     value="#{msg['import.startUserImport']}">
                    </h:commandButton>
                </div>

                <div class="col-xs-6">
                    <h3>#{msg['import.importedParticipants']}</h3>
                    <table class="table table-condensed">
                        <thead>
                        <tr>
                            <th>#{msg['common.name']}</th>
                            <th class="table-examination-identifier">#{msg['common.email']}</th>
                            <th class="table-examination-grade">#{msg['import.alreadyUser']}</th>
                        </tr>
                        </thead>
                        <tbody>
                        <ui:repeat value="#{studentImportController.course.students}" var="student">
                        <tr>
                            <td>#{student.user}</td>
                            <td>#{student.user.email}</td>
                            <td>#{studentImportController.isStudentWithExistingAccount(student)}</td>
                        </tr>
                        </ui:repeat>
                        </tbody>
                    </table>
                </div>
            </div>

            <hr />
            <div class="row form-buttons">
                <div class="col-xs-6">
                    <h:commandButton class="btn btn-default" action="#{courseCreateFlowController.getReturnValue()}"
                                     value="#{msg['common.cancel']}" immediate="true" />
                </div>
                <div class="col-xs-6 text-right">
                    <div class="btn-group">
                        <h:commandButton class="btn btn-default" action="step4"
                                         value="#{msg['common.back']}" />
                        <p:commandButton class="btn btn-primary" action="#{courseCreateFlowController.saveCourse()}"
                                         value="#{msg['courses.create.finish']}"
                                         oncomplete="#{userController.updateUserCourses()}">
                            <f:actionListener binding="#{courseCreateFlowController.setStepFinished(5)}"/>
                        </p:commandButton>
                    </div>
                </div>
            </div>
        </h:form>
    </ui:define>
</ui:composition>