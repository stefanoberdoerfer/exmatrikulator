<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:h5="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <p:dialog header="#{msg['gradings.insert']}" appendTo="@(body)" widgetVar="gradeInsert" modal="true">
        <h:form id="gradeInsertForm">
            <p:panel id="gradeInsertFormPnl">
            <ui:include src="/WEB-INF/alerts.xhtml" />
            <h:panelGroup layout="block" styleClass="modal-body">
                <div class="form-group">
                    <label for="gradeExamination" class="col-xs-3 control-label">
                        #{msg['common.course.exam']}
                    </label>
                    <div class="col-xs-9" id="gradeExamination">
                        <h:selectOneMenu value="#{gradingInsertController.formExam}"
                                         styleClass="form-control">
                            <c:if test="#{userController.isLecturer(gradingController.course)}">
                                <f:selectItem itemValue="-1" itemLabel="#{msg['gradeType.paboGrade']}" />
                            </c:if>
                            <f:selectItem itemValue="0" itemLabel="- - #{msg['common.pleaseSelect']} - -" />
                            <f:selectItems value="#{gradingController.course.exams}" var="exam"
                                           itemLabel="#{exam.name}" itemValue="#{exam.examId}" />
                            <f:ajax listener="#{gradingInsertController.changedExamSelection(gradingController.course)}"
                                    execute="@form"
                                    render="gradeInsertForm" />
                        </h:selectOneMenu>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gradeStudent" class="col-xs-3 control-label">
                        #{msg['common.student']}
                    </label>
                    <div class="col-xs-9" id="gradeStudent">
                        <p:autoComplete id="autocomplete"
                                        value="#{gradingInsertController.formStudent}"
                                        completeMethod="#{gradingInsertController.completeFormStudent}"
                                        minQueryLength="3" queryDelay="750">
                        </p:autoComplete>
                        <div class="alert alert-info">
                            #{msg['gradings.insert.student']}
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-3 control-label">#{msg['common.result']}</label>
                    <h:panelGroup layout="block" class="col-xs-9"
                                  rendered="#{gradingInsertController.formGradeType == -1}">
                        <h:selectOneMenu value="#{gradingInsertController.formGrading}"
                                         styleClass="form-control">
                            <f:selectItems value="#{gradingInsertController.paboGrades}" var="grade"
                                           itemLabel="#{grade.gradeName}" itemValue="#{grade.name()}" />
                        </h:selectOneMenu>
                    </h:panelGroup>
                    <h:panelGroup layout="block" class="col-xs-9"
                                  rendered="#{gradingInsertController.formGradeType != -1 and
                                  gradingInsertController.formGradeType != 2}">
                        <h:inputText styleClass="form-control"
                                     value="#{gradingInsertController.formGrading}"
                                     h5:autocomplete="off"/>
                    </h:panelGroup>
                    <h:panelGroup layout="block" class="col-xs-9"
                                  rendered="#{gradingInsertController.formGradeType == 2}">
                        <h:selectOneMenu value="#{gradingInsertController.formGrading}"
                                         styleClass="form-control">
                            <f:selectItem itemValue="-1" itemLabel="- - #{msg['common.pleaseSelect']} - -" />
                            <f:selectItem itemValue="1.00" itemLabel="#{msg['gradings.passed']}" />
                            <f:selectItem itemValue="0.00" itemLabel="#{msg['gradings.failed']}" />
                        </h:selectOneMenu>
                    </h:panelGroup>
                </div>
                <hr />
                <div class="form-group">
                    <label for="publicComment" class="col-xs-3 control-label">
                        #{msg['common.comments.public']}
                    </label>
                    <div class="col-xs-9">
                        <h:inputTextarea styleClass="form-control" id="publicComment" rows="4"
                                         value="#{gradingInsertController.formPublicComment}" />
                    </div>
                </div>
                <div class="form-group">
                    <label for="privateComment" class="col-xs-3 control-label">
                        #{msg['common.comments.private']}
                    </label>
                    <div class="col-xs-9">
                        <h:inputTextarea styleClass="form-control" id="privateComment" rows="4"
                                         value="#{gradingInsertController.formPrivateComment}" />
                    </div>
                </div>
            </h:panelGroup>
            <div class="modal-footer">
                <div class="btn-group" id="gradeInsertButtons">
                    <p:commandButton value="#{msg['common.cancel']}" type="button"
                                     onclick="return exModal(':gradeInsert');"
                                     styleClass="btn btn-default" />

                    <p:commandLink action="#{gradingInsertController.storeStudentGrading()}"
                                   id="gradeInsertSubmit"
                                   class="btn btn-primary" value="#{msg['gradings.insert']}"
                                   update="gradeInsertForm gradingForm"
                                   oncomplete="autofocusGradeInsert()"
                                   rendered="#{!gradingInsertController.overwriting}" />

                    <p:commandLink action="#{gradingInsertController.storeStudentGrading()}"
                                   id="gradeInsertSubmitConfirm"
                                   class="btn btn-danger" value="#{msg['gradings.overwrite']}"
                                   update="gradeInsertForm gradingForm"
                                   oncomplete="autofocusGradeInsert()"
                                   rendered="#{gradingInsertController.overwriting}"
                                   type="button" />

                    <c:if test="#{!gradingInsertController.overwriting}">
                        <p:defaultCommand target="gradeInsertSubmit" />
                    </c:if>
                    <c:if test="#{gradingInsertController.overwriting}">
                        <p:defaultCommand target="gradeInsertSubmitConfirm" />
                    </c:if>
                </div>
            </div>
            </p:panel>
            <p:blockUI block="gradeInsertFormPnl" trigger="gradeInsertSubmit"
                       rendered="#{!gradingInsertController.overwriting}">
                <div class="text-center">
                    <h:graphicImage library="images" name="el_toro_loading.svg" class="logo" />
                </div>
            </p:blockUI>
            <p:blockUI block="gradeInsertFormPnl" trigger="gradeInsertSubmitConfirm"
                       rendered="#{gradingInsertController.overwriting}">
                <div class="text-center">
                    <h:graphicImage library="images" name="el_toro_loading.svg" class="logo" />
                </div>
            </p:blockUI>
        </h:form>
    </p:dialog>
</ui:composition>